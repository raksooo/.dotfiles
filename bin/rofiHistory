#!/bin/sh

history_file=~/.local/share/rascal/rofiHistory
alias_file=/home/rascal/.dotfiles/config/aliases

rofi="rofi -dmenu -p > -i -width 40"
if [[ $1 ]] && [[ $1 != *"--all"* ]]; then
    rofi="$rofi -mesg $1"
    alt="calc $(echo $1 | sed 's/\=.*$//')\n"
fi

if [[ $* == *--all* ]]; then
    aliases=$(/usr/local/bin/listAliasNames $alias_file)
    b1=$(ls /usr/local/bin)
    b2=$(ls /usr/bin)
    alt=$(printf "$aliases\n$b1\n$b2")
else
    hst=$(printf "$(cat $history_file)\nrofiHistory --all")
    alt=$(printf "$alt$hst")
fi

result=$(printf "$alt" | $rofi)

if [[ "$result" =~ ^=.* ]]; then
    math=$(echo $result | sed "s/^=//")
    calc=$(python -c "print($math)")
    rofiHistory "$math=$calc"
else
    $result &
    if [[ $result = *[!\ ]* ]] && [[ $result != "rofiHistory"* ]] && [[ $result != "calc "* ]]; then
        newhst=$(printf "$(grep -v -x "$result" $history_file)")
        printf "$result\n$newhst" > $history_file
    fi
fi


