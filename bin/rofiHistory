#!/bin/sh

function execute {
    { error=$(($* &) 2>&1 1>&$out); } {out}>&1
    echo $error
}

history_file=~/.local/share/rascal/rofiHistory
alias_file=/home/rascal/.dotfiles/config/aliases
rofi_path=$(which rofiHistory)

rofi="rofi -dmenu -p > -i -width 40"
if [[ $1 ]] && [[ $1 != *"--all"* ]]; then
    rofi="$rofi -mesg $1"
    alt="calc $(echo $1 | sed 's/\=.*$//')\n"
fi

if [[ $* == *--all* ]]; then
    aliases=$(/usr/local/bin/listAliasNames $alias_file)
    b1=$(ls /usr/local/bin)
    b2=$(ls /usr/bin)
    alt=$(printf "$aliases\n$b1\n$b2")
else
    hst=$(printf "$(cat $history_file)\nrofiHistory --all")
    alt=$(printf "$alt$hst")
fi

result=$(printf "$alt" | $rofi)
if [[ $(execute $result) =~ ^$rofi_path.* ]]; then
    calc=$(python -c "print($result)")
    if [[ $? -eq 0 ]]; then
        rofiHistory "$result=$calc"
    fi
else
    if [[ $result = *[!\ ]* ]] && [[ $result != "rofiHistory"* ]] && [[ $result != "calc "* ]]; then
        newhst=$(printf "$(grep -v -x "$result" $history_file)")
        printf "$result\n$newhst" > $history_file
    fi
fi

