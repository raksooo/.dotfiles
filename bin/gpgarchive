#!/bin/sh

tmplocation="/tmp/gpgtar_archive$(date +%s)"
tmpdir="$tmplocation/"
tmparchive="$tmplocation.tar.gz"

function common {
    cd $tmpdir
    tar -zcf $tmparchive *
    cd - &> /dev/null
    rm -rf $tmpdir
    gpg --batch --yes --output $1 -r "Oskar Nyberg" -e $tmparchive
    rm -rf $tmparchive
}

if [[ $1 == "init" ]]; then
    mkdir $tmpdir
    cp -r $2 $tmpdir
    common $2.gpg
    rm -rf $2
else
    gpg --batch --yes --output $tmparchive -d $1
    mkdir $tmpdir
    tar -zxf $tmparchive --directory $tmpdir
    rm $tmparchive

    $TERMINAL -cd $tmpdir &> /dev/null
    common $1
fi

